---
# [Previous tasks remain the same until configuration part...]

    - name: Configure Hadoop files
      block:
        - name: Replace core-site.xml content
          replace:
            path: "{{ hadoop_install_dir }}/etc/hadoop/core-site.xml"
            regexp: '^[\s\S]*$'  # Match entire file content
            replace: |
              <?xml version="1.0" encoding="UTF-8"?>
              <?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
              <configuration>
                  <property>
                      <name>hadoop.tmp.dir</name>
                      <value>/home/hdoop/tmpdata</value>
                  </property>
                  <property>
                      <name>fs.default.name</name>
                      <value>hdfs://127.0.0.1:9000</value>
                  </property>
              </configuration>
          become: yes
          become_user: "{{ hadoop_user }}"

        - name: Replace hdfs-site.xml content
          replace:
            path: "{{ hadoop_install_dir }}/etc/hadoop/hdfs-site.xml"
            regexp: '^[\s\S]*$'  # Match entire file content
            replace: |
              <?xml version="1.0" encoding="UTF-8"?>
              <?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
              <configuration>
                  <property>
                      <name>dfs.data.dir</name>
                      <value>/home/hdoop/dfsdata/namenode</value>
                  </property>
                  <property>
                      <name>dfs.data.dir</name>
                      <value>/home/hdoop/dfsdata/datanode</value>
                  </property>
                  <property>
                      <name>dfs.replication</name>
                      <value>1</value>
                  </property>
              </configuration>
          become: yes
          become_user: "{{ hadoop_user }}"

        - name: Replace mapred-site.xml content
          replace:
            path: "{{ hadoop_install_dir }}/etc/hadoop/mapred-site.xml"
            regexp: '^[\s\S]*$'  # Match entire file content
            replace: |
              <?xml version="1.0"?>
              <?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
              <configuration>
                  <property>
                      <name>mapreduce.framework.name</name>
                      <value>yarn</value>
                  </property>
              </configuration>
          become: yes
          become_user: "{{ hadoop_user }}"

        - name: Replace yarn-site.xml content
          replace:
            path: "{{ hadoop_install_dir }}/etc/hadoop/yarn-site.xml"
            regexp: '^[\s\S]*$'  # Match entire file content
            replace: |
              <?xml version="1.0"?>
              <configuration>
                  <property>
                      <name>yarn.nodemanager.aux-services</name>
                      <value>mapreduce_shuffle</value>
                  </property>
                  <property>
                      <name>yarn.nodemanager.aux-services.mapreduce.shuffle.class</name>
                      <value>org.apache.hadoop.mapred.ShuffleHandler</value>
                  </property>
                  <property>
                      <name>yarn.resourcemanager.hostname</name>
                      <value>127.0.0.1</value>
                  </property>
                  <property>
                      <name>yarn.acl.enable</name>
                      <value>0</value>
                  </property>
                  <property>
                      <name>yarn.nodemanager.env-whitelist</name>
                      <value>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PERPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME</value>
                  </property>
              </configuration>
          become: yes
          become_user: "{{ hadoop_user }}"

# [Rest of the playbook remains the same...]
