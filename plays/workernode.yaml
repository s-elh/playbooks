---
- name: Reset and configure Hadoop XML files
  hosts: all
  become: yes
  vars:
    hadoop_conf_dir: "/usr/local/hadoop/etc/hadoop"
  tasks:
    - name: Supprimer le contenu de core-site.xml avant configuration
      copy:
        dest: "{{ hadoop_conf_dir }}/core-site.xml"
        content: ""
        force: true

    - name: Configurer core-site.xml
      copy:
        dest: "{{ hadoop_conf_dir }}/core-site.xml"
        content: |
          <configuration>
            <property>
              <name>fs.defaultFS</name>
              <value>hdfs://localhost:9000</value>
            </property>
          </configuration>

    - name: Supprimer le contenu de hdfs-site.xml avant configuration
      copy:
        dest: "{{ hadoop_conf_dir }}/hdfs-site.xml"
        content: ""
        force: true

    - name: Configurer hdfs-site.xml
      copy:
        dest: "{{ hadoop_conf_dir }}/hdfs-site.xml"
        content: |
          <configuration>
            <property>
              <name>dfs.replication</name>
              <value>1</value>
            </property>
            <property>
              <name>dfs.namenode.name.dir</name>
              <value>file:/usr/local/hadoop/data/namenode</value>
            </property>
            <property>
              <name>dfs.datanode.data.dir</name>
              <value>file:/usr/local/hadoop/data/datanode</value>
            </property>
          </configuration>

    - name: Supprimer le contenu de mapred-site.xml avant configuration
      copy:
        dest: "{{ hadoop_conf_dir }}/mapred-site.xml"
        content: ""
        force: true

    - name: Configurer mapred-site.xml
      copy:
        dest: "{{ hadoop_conf_dir }}/mapred-site.xml"
        content: |
          <configuration>
            <property>
              <name>mapreduce.framework.name</name>
              <value>yarn</value>
            </property>
          </configuration>

    - name: Supprimer le contenu de yarn-site.xml avant configuration
      copy:
        dest: "{{ hadoop_conf_dir }}/yarn-site.xml"
        content: ""
        force: true

    - name: Configurer yarn-site.xml
      copy:
        dest: "{{ hadoop_conf_dir }}/yarn-site.xml"
        content: |
          <configuration>
            <property>
              <name>yarn.nodemanager.aux-services</name>
              <value>mapreduce_shuffle</value>
            </property>
          </configuration>
