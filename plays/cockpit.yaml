- name: Install Cockpit on Ubuntu
  hosts: all
  become: yes

  tasks:
       # Basic system setup
    - name: Configure resolv.conf with Google DNS
      shell: echo nameserver 8.8.8.8 > /etc/resolv.conf
    
    - name: Clear apt proxy settings
      shell: echo > /etc/apt/apt.conf.d/90curtin-aptproxy
    - name: Update APT cache
      apt:
        update_cache: yes

    - name: Install Cockpit
      apt:
        name: cockpit
        state: present

    - name: Ensure Cockpit service is enabled and running
      systemd:
        name: cockpit
        enabled: yes
        state: started

    - name: Allow Cockpit through the firewall (if ufw is enabled)
      ufw:
        rule: allow
        port: 9090
        proto: tcp
      when: ansible_facts['os_family'] == "Debian"
